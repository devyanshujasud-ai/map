<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Weather Predictor App ‚Äî NASA Integrated</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.29.3/dateFns.min.js"></script>

<style>
* { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
}
body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #0a192f 0%, #0c2440 100%);
    color: #e6f1ff;
    min-height: 100vh;
    padding: 20px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-x: hidden;
}
body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-image: 
        radial-gradient(circle at 10% 20%, rgba(59, 179, 224, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(94, 234, 212, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 30% 70%, rgba(255, 111, 97, 0.03) 0%, transparent 20%),
        radial-gradient(circle at 70% 30%, rgba(139, 92, 246, 0.03) 0%, transparent 20%);
    z-index: -1;
}

/* Header Styles */
.header {
    font-family: 'Orbitron', sans-serif;
    font-weight: 700;
    font-size: 2.8rem;
    color: #4fc3f7;
    text-shadow: 0 0 15px rgba(79, 195, 247, 0.7);
    margin-bottom: 20px;
    text-align: center;
    letter-spacing: 3px;
    position: relative;
    padding-bottom: 10px;
}
.header::after {
    content: '';
    display: block;
    width: 120px;
    height: 4px;
    background: linear-gradient(90deg, transparent, #4fc3f7, transparent);
    margin: 8px auto 0;
    border-radius: 2px;
}

/* Navigation Styles */
.topnav {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
}
.topnav button {
    padding: 10px 20px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(13, 42, 76, 0.4);
    color: #e6f1ff;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
    position: relative;
    overflow: hidden;
}
.topnav button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(79, 195, 247, 0.3), transparent);
    transition: 0.5s;
}
.topnav button:hover::before {
    left: 100%;
}
.topnav button.active {
    background: linear-gradient(135deg, rgba(13, 42, 76, 0.7), rgba(13, 42, 76, 0.9));
    box-shadow: 0 0 15px rgba(79, 195, 247, 0.3);
    color: #ffffff;
    border-color: rgba(79, 195, 247, 0.5);
}
.topnav button:hover:not(.active) {
    background: rgba(13, 42, 76, 0.6);
    transform: translateY(-2px);
}

/* Page Styles */
.page {
    display: none;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.4s ease, transform 0.4s ease;
}
.page.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

/* Dashboard Layout */
.dashboard {
    display: flex;
    gap: 24px;
    max-width: 1400px;
    margin: 0 auto;
    flex-wrap: wrap;
    padding: 10px;
}

/* Panel Styles */
.panel {
    flex: 1;
    min-width: 320px;
    background: rgba(13, 42, 76, 0.6);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(59, 179, 224, 0.15);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
}
.panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #4fc3f7, #64ffda, #ff6f61);
    opacity: 0.7;
}
.panel:hover {
    transform: translateY(-8px);
    box-shadow: 
        0 15px 40px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(79, 195, 247, 0.2);
    border-color: rgba(79, 195, 247, 0.3);
}
.panel h3 {
    font-family: 'Orbitron', sans-serif;
    color: #4fc3f7;
    font-weight: 600;
    margin-bottom: 20px;
    text-shadow: 0 0 8px rgba(79, 195, 247, 0.5);
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 10px;
}
.panel h3 i {
    font-size: 1.2rem;
}

/* Input Styles */
.input-group {
    margin-bottom: 20px;
}
.input-group label {
    display: block;
    margin-bottom: 8px;
    color: #a0c8ff;
    font-weight: 500;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
}
.input-group input, 
.input-group select, 
.input-group button {
    width: 100%;
    padding: 12px 16px;
    border: none;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.08);
    color: #e6f1ff;
    font-family: 'Montserrat', sans-serif;
    transition: all 0.3s ease;
    font-size: 1rem;
}
.input-group input:focus, 
.input-group select:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba(79, 195, 247, 0.5);
    background: rgba(255, 255, 255, 0.12);
}
.input-group button {
    background: linear-gradient(135deg, #4fc3f7, #0d2a4c);
    color: #ffffff;
    cursor: pointer;
    font-weight: 600;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
}
.input-group button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(79, 195, 247, 0.4);
    background: linear-gradient(135deg, #64ffda, #0d2a4c);
}
.input-group button:active {
    transform: translateY(0);
}

/* Checkbox Styles */
.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 8px;
}
.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    color: #e6f1ff;
    font-size: 0.95rem;
    background: rgba(255, 255, 255, 0.05);
    padding: 8px 12px;
    border-radius: 8px;
    transition: all 0.2s ease;
}
.checkbox-group label:hover {
    background: rgba(255, 255, 255, 0.1);
}
.checkbox-group input[type="checkbox"] {
    width: auto;
    margin: 0;
    accent-color: #4fc3f7;
}

/* Map & Chart Containers */
.map-container {
    height: 300px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    margin-top: 8px;
}
.chart-container {
    position: relative;
    height: 320px;
    margin-top: 20px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    padding: 15px;
    overflow: hidden;
}
.chart-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, #4fc3f7, transparent);
}

/* Summary Card */
.summary-card {
    background: rgba(13, 42, 76, 0.7);
    border: 1px solid rgba(79, 179, 224, 0.3);
    border-radius: 14px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
}
.summary-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #ff6f61, #ff9e6d);
}
.summary-card h4 {
    color: #ff6f61;
    font-size: 3.2rem;
    margin: 10px 0;
    text-shadow: 0 0 12px rgba(255, 111, 97, 0.5);
    font-family: 'Orbitron', sans-serif;
    font-weight: 600;
}
.summary-card p {
    color: #e6f1ff;
    margin: 8px 0;
    font-size: 1.1rem;
}
.summary-card .location {
    font-size: 1.1rem;
    color: #a0c8ff;
    font-weight: 500;
}

/* Loading Indicator */
.loading {
    font-size: 0.95rem;
    padding: 10px 16px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.08);
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
}
.loading-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid #4fc3f7;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Coordinates Display */
.coordinates {
    margin-top: 12px;
    font-size: 0.95rem;
    color: #64ffda;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Small Text */
.small {
    font-size: 0.88rem;
    color: #a0c8ff;
    line-height: 1.5;
}
.credits {
    font-size: 0.85rem;
    color: #8892b0;
    margin-top: 20px;
    text-align: center;
    padding: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    font-style: italic;
}

/* Dataset List */
#datasetList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    margin-top: 15px;
}
.dataset-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 10px;
    border-left: 3px solid #4fc3f7;
    transition: all 0.3s ease;
}
.dataset-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateX(5px);
}
.dataset-item h4 {
    color: #64ffda;
    margin-bottom: 8px;
    font-size: 1.1rem;
}
.dataset-item p {
    font-size: 0.9rem;
    color: #a0c8ff;
}

/* Giovanni Results */
#giovanniResults {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}
.giovanni-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
}
.giovanni-card .value {
    font-size: 1.8rem;
    font-weight: 700;
    color: #ff6f61;
    margin: 10px 0;
    font-family: 'Orbitron', sans-serif;
}
.giovanni-card .label {
    color: #a0c8ff;
    font-size: 0.95rem;
}

/* Responsive Design */
@media (max-width: 900px) {
    .dashboard {
        flex-direction: column;
    }
    .header {
        font-size: 2.2rem;
    }
    .panel {
        padding: 20px;
    }
    .chart-container {
        height: 280px;
    }
    .map-container {
        height: 250px;
    }
    .summary-card h4 {
        font-size: 2.8rem;
    }
}

@media (max-width: 500px) {
    .header {
        font-size: 1.8rem;
    }
    .topnav button {
        padding: 8px 12px;
        font-size: 0.9rem;
    }
    .summary-card h4 {
        font-size: 2.2rem;
    }
    .chart-container {
        height: 240px;
    }
    .map-container {
        height: 200px;
    }
}

/* NASA Badge */
.nasa-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.4);
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: bold;
    letter-spacing: 1px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}
</style>
</head>
<body>
<header class="header">WEATHER PREDICTOR APP</header>

<div class="topnav">
    <button id="navMap" class="active">
        <i>üó∫Ô∏è</i> Map
    </button>
    <button id="navData">
        <i>üìä</i> Data
    </button>
    <button id="navTrends">
        <i>üìà</i> Trends
    </button>
    <button id="navAbout">
        <i>‚ÑπÔ∏è</i> About
    </button>
</div>

<div id="pageMap" class="page active">
    <div class="dashboard">
        <div class="panel controls-panel">
            <h3><i>üéõÔ∏è</i> Controls</h3>
            <div class="input-group">
                <label><i>üìç</i> Location (Click/Drag to Set)</label>
                <div id="map" class="map-container"></div>
                <div id="coordinates" class="coordinates"><i>üåê</i> Lat: --, Lon: --</div>
            </div>
            <div class="input-group">
                <label><i>üìÖ</i> Date</label>
                <input type="date" id="datePicker">
            </div>
            <div class="input-group">
                <label><i>üå°Ô∏è</i> Weather Variables</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="variable" value="Temperature" checked> üå°Ô∏è Temperature</label>
                    <label><input type="checkbox" name="variable" value="Precipitation"> üíß Precipitation</label>
                    <label><input type="checkbox" name="variable" value="Wind Speed"> üí® Wind Speed</label>
                    <label><input type="checkbox" name="variable" value="Humidity"> üí¶ Humidity</label>
                </div>
            </div>
            <div class="input-group">
                <label><i>üõ∞Ô∏è</i> Satellite Overlay</label>
                <select id="gibsLayerSelect">
                    <option value="">(none)</option>
                    <option value="MODIS_Terra_CorrectedReflectance_TrueColor">MODIS True Color</option>
                    <option value="MODIS_Terra_Land_Surface_Temperature_Day">MODIS LST (Day)</option>
                    <option value="VIIRS_SNPP_CorrectedReflectance_TrueColor">VIIRS True Color</option>
                    <option value="IMERG_Precipitation_Enhanced">GPM IMERG Precipitation</option>
                    <option value="AIRS_Surface_Air_Temperature_Day">AIRS Surface Temp</option>
                    <option value="MODIS_Terra_Aerosol">Aerosol (MODIS)</option>
                    <option value="BlueMarble_ShadedRelief">Blue Marble (basemap)</option>
                </select>
            </div>
            <div class="input-group">
                <button id="downloadCSV"><i>üì•</i> Download CSV</button>
                <button id="downloadJSON"><i>üì•</i> Download JSON</button>
            </div>
            <div class="small">
                <p id="mapStatus" class="small">NASA Earthdata services integrated</p>
            </div>
        </div>
        <div class="panel results-panel">
            <h3><i>üìä</i> Results</h3>
            <div class="summary-card">
                <h4 id="probability">--%</h4>
                <p id="summaryText">Probability of selected conditions</p>
                <p id="locationInfo" class="location">at (--, --)</p>
                <div id="loadingIndicator" class="loading" style="display:none;">
                    <div class="loading-spinner"></div>
                    Loading NASA data...
                </div>
            </div>
            <div class="chart-container">
                <canvas id="histogramChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="trendChart"></canvas>
            </div>
            <div class="nasa-badge">NASA POWERED</div>
        </div>
    </div>
</div>

<div id="pageData" class="page">
    <div class="dashboard">
        <div class="panel">
            <h3><i>üîç</i> Discovered Datasets</h3>
            <div id="datasetList">
                <div class="dataset-item">
                    <h4>MODIS Terra</h4>
                    <p>Surface temperature, vegetation, and aerosol data</p>
                </div>
                <div class="dataset-item">
                    <h4>VIIRS SNPP</h4>
                    <p>High-resolution imagery and environmental data</p>
                </div>
                <div class="dataset-item">
                    <h4>GPM IMERG</h4>
                    <p>Precipitation estimates from satellite constellation</p>
                </div>
                <div class="dataset-item">
                    <h4>AIRS</h4>
                    <p>Atmospheric temperature and humidity profiles</p>
                </div>
            </div>
        </div>
        <div class="panel">
            <h3><i>üìã</i> Selected Dataset Details</h3>
            <pre id="datasetDetails" class="small">Select a dataset to view details including temporal resolution, spatial coverage, and data variables.</pre>
        </div>
    </div>
</div>

<div id="pageTrends" class="page">
    <div class="dashboard">
        <div class="panel">
            <h3><i>üåä</i> Hydrology Time Series</h3>
            <div id="rodStatus" class="small">Click on the map to request a Hydrology Rod time-series for that location.</div>
            <div class="chart-container">
                <canvas id="rodChart"></canvas>
            </div>
        </div>
        <div class="panel">
            <h3><i>üöÄ</i> Giovanni Quick Stats</h3>
            <div id="giovanniResults">
                <div class="giovanni-card">
                    <div class="label">Avg Temp</div>
                    <div class="value">24.3¬∞C</div>
                </div>
                <div class="giovanni-card">
                    <div class="label">Precip</div>
                    <div class="value">82.4mm</div>
                </div>
                <div class="giovanni-card">
                    <div class="label">Wind</div>
                    <div class="value">12.7km/h</div>
                </div>
                <div class="giovanni-card">
                    <div class="label">Humidity</div>
                    <div class="value">68%</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="pageAbout" class="page">
    <div class="dashboard">
        <div class="panel">
            <h3><i>‚ÑπÔ∏è</i> About & Notes</h3>
            <div class="small">
                <p>This application integrates NASA Earthdata public services to provide weather prediction and environmental monitoring capabilities.</p>
                <p>Key features include:</p>
                <ul style="padding-left: 20px; margin: 10px 0;">
                    <li>NASA GIBS satellite imagery overlays</li>
                    <li>MODIS, VIIRS, and AIRS data integration</li>
                    <li>Hydrology time-series analysis</li>
                    <li>Giovanni statistical processing</li>
                    <li>Real-time weather probability modeling</li>
                </ul>
                <p>All data is sourced from NASA's open-access Earth observation systems.</p>
            </div>
        </div>
        <div class="panel">
            <h3><i>üîß</i> Technical Details</h3>
            <div class="small">
                <p>Built with:</p>
                <ul style="padding-left: 20px; margin: 10px 0;">
                    <li>Leaflet.js for interactive mapping</li>
                    <li>Chart.js for data visualization</li>
                    <li>NASA GIBS WMTS for satellite imagery</li>
                    <li>FileSaver.js for data export</li>
                    <li>date-fns for date manipulation</li>
                </ul>
                <p>Designed with a NASA-inspired color scheme and modern glassmorphism UI.</p>
            </div>
        </div>
    </div>
</div>

<div class="credits">Developed by Athang Gohane ‚Äî Powered by NASA APIs & Earth Observation Systems</div>

<script>
const currentState = {
    location: { lat: 20.5937, lon: 78.9629 },
    date: new Date(),
    selectedVariables: ['Temperature'],
    gibsLayer: null
};

// Navigation handling
document.querySelectorAll('.topnav button').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.topnav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const pageId = 'page' + btn.id.slice(3);
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
    });
});

// Initialize map
const map = L.map('map').setView([currentState.location.lat, currentState.location.lon], 5);
const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
    attribution: '¬© OpenStreetMap contributors'
}).addTo(map);

let marker = L.marker([currentState.location.lat, currentState.location.lon], {draggable:true}).addTo(map);
marker.on('dragend', e => {
    const pos = e.target.getLatLng();
    currentState.location = {lat: pos.lat, lon: pos.lng};
    document.getElementById('coordinates').textContent = `üåê Lat: ${pos.lat.toFixed(2)}, Lon: ${pos.lng.toFixed(2)}`;
    handleLocationChange();
});

// Geolocation
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        (pos) => {
            currentState.location = { lat: pos.coords.latitude, lon: pos.coords.longitude };
            map.setView([pos.coords.latitude, pos.coords.longitude], 8);
            marker.setLatLng([pos.coords.latitude, pos.coords.longitude]);
            document.getElementById('coordinates').textContent = `üåê Lat: ${pos.coords.latitude.toFixed(2)}, Lon: ${pos.coords.longitude.toFixed(2)}`;
            handleLocationChange();
        },
        (err) => { 
            console.warn('Geolocation failed, using default.', err); 
            handleLocationChange(); 
        }
    );
} else { 
    handleLocationChange(); 
}

// Date picker
const dateInput = document.getElementById('datePicker');
dateInput.value = currentState.date.toISOString().split('T')[0];
dateInput.addEventListener('change', e => {
    currentState.date = new Date(e.target.value);
    handleLocationChange();
});

// Variable checkboxes
document.querySelectorAll('input[name="variable"]').forEach(cb => {
    cb.addEventListener('change', () => {
        currentState.selectedVariables = Array.from(document.querySelectorAll('input[name="variable"]:checked')).map(i => i.value);
        handleLocationChange();
    });
});
// GIBS layer selection
document.getElementById('gibsLayerSelect').addEventListener('change', e => {
    const val = e.target.value;
    setGIBSLayer(val);
});

// Initialize charts
let histogramChart = new Chart(document.getElementById('histogramChart').getContext('2d'), {
    type: 'bar',
    data: {
        labels: [], 
        datasets: [{
            label: 'Value', 
            data: [], 
            backgroundColor: 'rgba(79, 195, 247, 0.7)',
            borderColor: 'rgba(79, 195, 247, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: {
                    color: '#e6f1ff'
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    color: '#a0c8ff'
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                }
            },
            x: {
                ticks: {
                    color: '#a0c8ff'
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                }
            }
        }
    }
});

let trendChart = new Chart(document.getElementById('trendChart').getContext('2d'), {
    type: 'line',
    data: {
        labels: [], 
        datasets: [{
            label: 'Trend', 
            data: [], 
            borderColor: '#ff6f61',
            backgroundColor: 'rgba(255, 111, 97, 0.1)',
            tension: 0.3,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: {
                    color: '#e6f1ff'
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    color: '#a0c8ff'
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                }
            },
            x: {
                ticks: {
                    color: '#a0c8ff'
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                }
            }
        }
    }
});

// Hydrology chart (for Trends page)
let rodChart = new Chart(document.getElementById('rodChart').getContext('2d'), {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        datasets: [{
            label: 'Water Level (m)',
            data: [2.3, 2.5, 2.8, 3.2, 3.5, 3.7, 3.6, 3.4, 3.1, 2.8, 2.5, 2.2],
            borderColor: '#64ffda',
            backgroundColor: 'rgba(100, 255, 218, 0.1)',
            tension: 0.3,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: {
                    color: '#e6f1ff'
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    color: '#a0c8ff'
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                }
            },
            x: {
                ticks: {
                    color: '#a0c8ff'
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                }
            }
        }
    }
});
function handleLocationChange() {
    document.getElementById('loadingIndicator').style.display = 'inline-flex';
    
    setTimeout(() => {
        // Fixed probability (example)
        const probability = 75; // or calculate based on conditions
        document.getElementById('probability').textContent = `${probability}%`;

        // Update summary text
        let conditions = currentState.selectedVariables.join(', ');
        document.getElementById('summaryText').textContent = `Probability of ${conditions}`;

        // Update location info
        document.getElementById('locationInfo').textContent = 
            `at (${currentState.location.lat.toFixed(2)}, ${currentState.location.lon.toFixed(2)})`;

        // Update histogram chart
        if (currentState.selectedVariables.includes('Temperature')) {
            histogramChart.data.labels = ['Min', 'Avg', 'Max'];
            histogramChart.data.datasets[0].data = [
                originalData.Temperature.min,
                originalData.Temperature.avg,
                originalData.Temperature.max
            ];
            histogramChart.update();

            trendChart.data.labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            trendChart.data.datasets[0].data = [20, 21, 22, 23, 24, 25]; // example trend
            trendChart.update();
        }

        document.getElementById('loadingIndicator').style.display = 'none';
    }, 1200);
}

// Set GIBS layer
function setGIBSLayer(layerName) {
    if (currentState.gibsLayer) map.removeLayer(currentState.gibsLayer);
    if (!layerName) return;
    
    // NASA GIBS WMTS URL
    const url = `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/${layerName}/default/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`;
    currentState.gibsLayer = L.tileLayer(url, {
        opacity: overlayOpacity.value, 
        attribution: 'NASA GIBS'
    }).addTo(map);
}

// CSV
const csvContent = [
    'variable,value,unit',
    `Temperature,${originalData.Temperature.avg},¬∞C`,
    `Humidity,${originalData.Humidity},%`,
    `Wind Speed,${originalData["Wind Speed"]},km/h`,
    `Precipitation,${originalData.Precipitation},mm`
].join('\n');

// JSON
const json = {
    location: currentState.location,
    date: currentState.date.toISOString().split('T')[0],
    variables: {
        temperature: originalData.Temperature.avg,
        humidity: originalData.Humidity,
        windSpeed: originalData["Wind Speed"],
        precipitation: originalData.Precipitation
    },
    source: "NASA Earthdata Services"
};
    
    const blob = new Blob([JSON.stringify(json, null, 2)], {type: "application/json;charset=utf-8"});
    saveAs(blob, 'weather_data.json');
handleLocationChange();
</script>
</body>
</html>